<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>NBA Close Matches</title>
  <script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <style media="screen">
    /*html, body, #vis {
      height: 100%;
      margin: 0;
    }*/
  </style>
</head>
<body>
  <div id="input">
    <label>Select a team
      <select id="myteam">
      </select>
    </label>
    <!-- <input type="button" id="search_button" value="Go!"> -->
  </div>
  <!-- <div id="vis"></div> -->
  <svg width="960" height="500"></svg>
  <script>

  var svg = d3.select("svg"),
      margin = {top: 20, right: 20, bottom: 30, left: 50},
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var parseTime = d3.timeParse("%d-%b-%y");

  var x = d3.scaleTime()
      .rangeRound([0, width]);

  var y = d3.scaleLinear()
      .rangeRound([height, 0]);

  var line = d3.line()
      .x(function(d) { return x(d.seconds_left); })
      .y(function(d) { return y(d.num_ic_inc); })
      .curve(d3.curveCardinal);


  var select = d3.select("#myteam");


  d3.csv("win.csv", type, function(error, data) {
    if (error) throw error;
    select.selectAll("option")
      .data(data)
      .enter()
      .append("option")
      .attr("value", function(d) { return d.index; })
      .text(function(d) { return d.index; });
  });

  function draw(value) {
    d3.csv("calls/" + value + ".csv", type, function(error, data) {
      console.log(data);
      console.log(data);

      x.domain(d3.extent(data, function(d) { return d.seconds_left; }));
      y.domain(d3.extent(data, function(d) { return d.num_ic_inc; }));

      g.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
        .select(".domain")
          .remove();

      g.append("g")
          .call(d3.axisLeft(y))
        .append("text")
          .attr("fill", "#000")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", "0.71em")
          .attr("text-anchor", "end")
          .text("Price ($)");

      g.append("path")
          .datum(data)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-linejoin", "round")
          .attr("stroke-linecap", "round")
          .attr("stroke-width", 1.5)
          .attr("d", line);
    });
  }





      // // https://bl.ocks.org/DimsumPanda/689368252f55179e12185e13c5ed1fee
      // var width = document.getElementById("vis")
      //     .clientWidth;
      //
      // var height = document.getElementById("vis")
      //     .clientHeight
      //
      // var margin = {
      //     top: 20,
      //     bottom: 30,
      //     left: 40,
      //     right: 180
      // }
      //
      // var svg = d3.select("#vis")
      //     .append("svg")
      //     .attr("width", width)
      //     .attr("height", height)
      //     .append("g")
      //     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      //
      // width = width - margin.left - margin.right;
      // height = height - margin.top - margin.bottom;
      //
      // var y = d3.scaleBand()
      //     .rangeRound([height, 0])
      //     .padding(0.3)
      //     .align(0.3);
      //
      // var x = d3.scaleLinear()
      //     .rangeRound([0, width]);
      //
      // var z = d3.scaleOrdinal(d3.schemeCategory20)
      //     .range(["green", "red"]);
      //
      // var stack = d3.stack();
      //
      // var select = d3.select("#myteam");
      // d3.csv("win.csv", type, function(error, data) {
      //   if (error) throw error;
      //   select.selectAll("option")
      //     .data(data)
      //     .enter()
      //     .append("option")
      //     .attr("value", function(d) { return d.index; })
      //     .text(function(d) { return d.index; });
      // });
      //
      //
      //
      // function draw(value) {
      //   d3.csv("test/" + value + ".csv", type, function(error, data) {
      //
      //     data.sort(function(a, b) { return b[data.columns[1]] / b.total - a[data.columns[1]] / a.total; });
      //
      //     y.domain(data.map(function(d) { return d.index; } ));
      //     x.domain([0, d3.max(data, function(d) { return d.total; })]).nice();
      //     z.domain(data.columns.slice(1));
      //
      //     svg.selectAll(".serie").remove();
      //
      //     var new_layer = svg.selectAll(".serie")
      //       .data(stack.keys(data.columns.slice(1))(data))
      //       .enter().append("g")
      //         .attr("class", "serie")
      //         .attr("fill", function(d) { return z(d.key); })
      //       .selectAll("rect")
      //       .data(function(d) { return d; })
      //       .enter().append("rect")
      //         .attr("y", function(d) { console.log(d.data.index);return y(d.data.index); })
      //         .attr("x", function(d) { return x(d[0]); })
      //         .attr("width", function(d) { return x(d[1]) - x(d[0]); })
      //         .attr("height", y.bandwidth());
      //
      //
      //     svg.append("g")
      //         .attr("class", "axis axis--x")
      //         .attr("transform", "translate(0," + height + ")")
      //         .call(d3.axisBottom(x))
      //     svg.append("g")
      //         .attr("class", "axis axis--y")
      //         .attr("transform", "translate(0,0)")
      //         .call(d3.axisLeft(y))
      //
      //     var legend = svg.selectAll(".legend")
      //       .data(data.columns.slice(1).reverse())
      //       .enter().append("g")
      //         .attr("class", "legend")
      //         .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })
      //         .style("font", "10px sans-serif");
      //
      //     legend.append("rect")
      //         .attr("x", width + 18)
      //         .attr("width", 18)
      //         .attr("height", 18)
      //         .attr("fill", z);
      //
      //     legend.append("text")
      //         .attr("x", width + 44)
      //         .attr("y", 9)
      //         .attr("dy", ".35em")
      //         .attr("text-anchor", "start")
      //         .text(function(d) { return d; });
      // });
      //
      // }
      //
      select
          .on("change", function(d) {
            var value = d3.select(this).property("value");
            draw(value);
          });

      function type(d, i, columns) {
        for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
        d.total = t;
        return d;
      }

      draw("SAS")


    // d3.csv("win.csv", type, function(error, data) {
    //   if (error) throw error;
    //   var select = d3.select("#myteam")
    //       // .append("select")
    //
    //   select
    //       .on("change", function(d) {
    //         var value = d3.select(this).property("value");
    //         draw(value);
    //       });
    //
    //   select.selectAll("option")
    //     .data(data)
    //     .enter()
    //     .append("option")
    //     .attr("value", function(d) { return d.value; })
    //     .text(function(d) { return d.index; });
    //
    //
    //   function draw(value) {
    //
    //     data.sort(function(a, b) { return b.total - a.total; });
    //
    //     y.domain(data.map(function(d) { return d.index; } ));
    //     x.domain([0, d3.max(data, function(d) { return d.total; })]).nice();
    //     z.domain(data.columns.slice(1));
    //
    //
    //     var team_data = data.filter(function(d){ return d.index === value });
    //     console.log(team_data);
    //
    //     var bars = svg.selectAll(".serie")
    //       .data(stack.keys(data.columns.slice(1))(team_data));
    //
    //       // exit
    //     bars
    //       .exit()
    //       .remove();
    //
    //     // enter
    //     var new_bars = bars
    //       .enter().append("g")
    //         .attr("class", "serie")
    //         .attr("fill", function(d) { return z(d.key); })
    //       .selectAll("rect")
    //       .data(function(d) { return d; })
    //       .enter().append("rect")
    //       // .attr("y", function(d) { return y(d.data.index); })
    //       .attr("x", function(d) { return x(d[0]); })
    //       .attr("width", function(d) { return x(d[1]) - x(d[0]); })
    //       .attr("height", y.bandwidth());
    //
    //     // update
    //     new_bars.merge(bars)
    //       .attr("x", function(d) { return x(d[0]); })
    //       .attr("width", function(d) { return x(d[1]) - x(d[0]); })
    //       .attr("height", y.bandwidth());
    //   }
    //
    //
    //
    //   svg.append("g")
    //       .attr("class", "axis axis--x")
    //       .attr("transform", "translate(0," + height + ")")
    //       .call(d3.axisBottom(x))
    //   svg.append("g")
    //       .attr("class", "axis axis--y")
    //       .attr("transform", "translate(0,0)")
    //       .call(d3.axisLeft(y))
    //
    //   var legend = svg.selectAll(".legend")
    //     .data(data.columns.slice(1).reverse())
    //     .enter().append("g")
    //       .attr("class", "legend")
    //       .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })
    //       .style("font", "10px sans-serif");
    //
    //   legend.append("rect")
    //       .attr("x", width + 18)
    //       .attr("width", 18)
    //       .attr("height", 18)
    //       .attr("fill", z);
    //
    //   legend.append("text")
    //       .attr("x", width + 44)
    //       .attr("y", 9)
    //       .attr("dy", ".35em")
    //       .attr("text-anchor", "start")
    //       .text(function(d) { return d; });
    // draw("ATL");
    // });


  </script>

</body>
</html>
